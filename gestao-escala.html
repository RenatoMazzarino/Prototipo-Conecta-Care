<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conecta Care - Gestão de Escala</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <header class="global-top-bar">
        <div class="top-bar-left">
            <span class="material-icons-outlined sidebar-toggle" id="sidebar-toggle">menu</span>
            <a href="dashboard.html" class="logo">
                <span class="material-icons-outlined" style="color: var(--color-accent);">health_and_safety</span>
                Conecta Care
            </a>
        </div>
        
        <div class="top-bar-center">
            <div class="global-search">
                <span class="material-icons-outlined">search</span>
                <input type="text" placeholder="Pesquisar pacientes, profissionais...">
            </div>
        </div>
        
        <div class="top-bar-right">
            <span class="material-icons-outlined icon-action">notifications</span>
            <div class="user-profile">
                <div class="user-photo">HC</div>
                <span class="user-name">Home Care XYZ</span>
                <span class="material-icons-outlined">expand_more</span>
            </div>
        </div>
    </header>

    <div class="main-layout" id="main-layout">
        
        <aside class="sidebar" id="sidebar">
            <nav>
                <a href="dashboard.html" class="nav-item">
                    <span class="material-icons-outlined">dashboard</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="gestao-escala.html" class="nav-item active">
                    <span class="material-icons-outlined">calendar_today</span>
                    <span class="nav-text">Gestão de Escala</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="material-icons-outlined">medical_services</span>
                    <span class="nav-text">Gestão de Plantões</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="material-icons-outlined">groups</span>
                    <span class="nav-text">Pacientes</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="material-icons-outlined">badge</span>
                    <span class="nav-text">Profissionais</span>
                </a>
                <a href="#" class="nav-item">
                    <span class="material-icons-outlined">payments</span>
                    <span class="nav-text">Financeiro</span>
                </a>
                <div class="nav-item" style="margin-top: 30px; border-top: 1px solid var(--color-border); padding-top: 15px;">
                    <span class="material-icons-outlined">settings</span>
                    <span class="nav-text">Configurações</span>
                </div>
                <a href="index.html" class="nav-item"> <span class="material-icons-outlined">logout</span>
                    <span class="nav-text">Desconectar</span>
                </a>
            </nav>
        </aside>

        <main class="content-stage" id="content-stage">
            
            <div class="content-header">
                <div>
                    <h1>Gestão de Escala</h1>
                    <p style="font-size: 0.9rem; color: var(--color-text-subtle); margin-top: 5px;">Home Care - Unidade Campinas</p>
                </div>
                <button class="btn-accent">
                    <span class="material-icons-outlined">add</span>
                    PUBLICAR NOVA VAGA
                </button>
            </div>

            <div class="content-tabs">
                <div class="tab-item active">GESTÃO DE ESCALA</div>
                <div class="tab-item">MONITORAMENTO EM TEMPO REAL</div>
            </div>

            <div class="status-cards">
                <div class="status-card">
                    <p>Total de Pacientes</p>
                    <h2>124</h2>
                </div>
                <div class="status-card vagas">
                    <p>Vagas em Aberto</p>
                    <h2>17</h2>
                </div>
                <div class="status-card ocupados">
                    <p>Plantões Ocupados</p>
                    <h2>352</h2>
                </div>
                <div class="status-card calendar-nav">
                    <span class="material-icons-outlined">chevron_left</span>
                    <span style="font-weight: 600; font-size: 1.1rem;">Outubro, 2025</span>
                    <span class="material-icons-outlined">chevron_right</span>
                </div>
            </div>

            <div class="scale-grid">
                <table class="scale-table">
                    <thead>
                        <tr>
                            <th class="cell-paciente">PACIENTE</th>
                            <th>Segunda, 06</th>
                            <th>Terça, 07</th>
                            <th>Quarta, 08</th>
                            <th>Quinta, 09</th>
                            <th>Sexta, 10</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="cell-paciente">Srª. Maria Lopes</td>
                            <td class="cell-day">
                                <div class="slot-card filled">
                                    <span class="initials" style="background-color: #00BCD4;">CN</span> Carla Nogueira
                                </div>
                                <div class="slot-card open" onclick="openFlyout('vaga-123')">
                                    <span class="material-icons-outlined">add_circle_outline</span>
                                    Preencher noturno
                                </div>
                            </td>
                            <td class="cell-day">
                                <div class="slot-card filled">
                                    <span class="initials" style="background-color: #4CAF50;">FB</span> Fábio Bastos
                                </div>
                                <div class="slot-card filled">
                                    <span class="initials" style="background-color: #FF9800;">DL</span> Diogo Lima
                                </div>
                            </td>
                            <td class="cell-day"></td>
                            <td class="cell-day"></td>
                            <td class="cell-day"></td>
                        </tr>
                        <tr>
                            <td class="cell-paciente">Sr. Jorge Mendes</td>
                            <td class="cell-day"></td>
                            <td class="cell-day"></td>
                            <td class="cell-day"></td>
                            <td class="cell-day">
                                <div class="slot-card open" onclick="openFlyout('vaga-456')" style="font-weight: 700;">
                                    <span class="material-icons-outlined">warning_amber</span>
                                    URGENTE diurno
                                </div>
                                <div class="slot-card filled">
                                    <span class="initials" style="background-color: #E91E63;">DM</span> Diana Magalhães
                                </div>
                            </td>
                            <td class="cell-day"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
        </main>
    </div>

    <div class="flyout-overlay" id="flyoutCandidaturas">
        <div class="flyout-container">
            <div class="flyout-header">
                <h3>Candidaturas: Vaga Diurna</h3>
                <span class="material-icons-outlined" style="cursor: pointer;" onclick="closeFlyout()">close</span>
            </div>
            
            <div class="flyout-content">
                <p style="color: var(--color-text-subtle); margin-bottom: 20px;">
                    Vaga: Srª. Maria Lopes | Segunda, 06/10 | 20h00 - 08h00
                </p>
                <div style="margin-bottom: 20px; font-weight: 600;">
                    <span style="color: var(--color-primary);">2 Candidatos</span>
                </div>
                <div class="candidate-list">
                    
                    <div class="candidate-item" onclick="openModal('Fábio Bastos', 'FB', '#4CAF50', 4.5, 'ativo')">
                        <div class="candidate-details">
                            <div class="candidate-photo" style="background-color: #4CAF50;">FB</div>
                            <div>
                                <span style="font-weight: 600;">Fábio Bastos</span>
                                <div style="font-size: 0.8rem; color: var(--color-success);">
                                    <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">star</span> 4.5 (15 Plantões)
                                </div>
                            </div>
                        </div>
                        <span class="coren-status active">COREN ATIVO</span>
                    </div>
                    
                    <div class="candidate-item" onclick="openModal('Carla Nogueira', 'CN', 'var(--color-text-subtle)', 3.0, 'inativo')">
                        <div class="candidate-details">
                            <div class="candidate-photo" style="background-color: var(--color-text-subtle);">CN</div>
                            <div>
                                <span style="font-weight: 600;">Carla Nogueira</span>
                                <div style="font-size: 0.8rem; color: var(--color-text-subtle);">
                                    <span class="material-icons-outlined" style="font-size: 14px; vertical-align: middle;">star</span> 3.0 (7 Plantões)
                                </div>
                            </div>
                        </div>
                        <span class="coren-status" style="background-color: #FEEBEB; color: var(--color-urgent);">COREN INATIVO</span>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalPerfil">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">close</span>
            
            <div class="profile-header">
                <div class="profile-photo-wrapper">
                    <div class="profile-photo" id="modal-photo"></div>
                    <div class="profile-coren-tag" id="modal-coren-tag">
                        </div>
                </div>
                <div class="profile-details">
                    <h4 id="modal-name">Nome do Profissional</h4>
                    <div class="star-rating" id="modal-rating">
                        </div>
                    <p style="color: var(--color-text-subtle); margin: 5px 0 0 0;" id="modal-coren-id">Coren SP-123456</p>
                </div>
            </div>

            <div class="profile-body">
                <p style="font-weight: 600;">Resumo da Avaliação:</p>
                <ul style="color: var(--color-text-subtle); font-size: 0.95rem;">
                    <li><strong>Especialidades:</strong> Home Care, Pediatria, Administração de Medicamentos IV.</li>
                    <li><strong>Distância da Vaga:</strong> 4.2 km (Tempo estimado de chegada: 15 min).</li>
                </ul>
                
                <div class="profile-reviews">
                    <h5>Avaliações Recebidas</h5>
                    <div id="modal-reviews-list">
                        </div>
                </div>
            </div>

            <div class="profile-actions">
                <button class="btn-action btn-reject">REPROVAR</button>
                <button class="btn-action btn-chat">ABRIR CHAT</button>
                <button class="btn-action btn-approve">APROVAR PROFISSIONAL</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggleButton = document.getElementById('sidebar-toggle');
            const sidebar = document.getElementById('sidebar');
            const mainLayout = document.getElementById('main-layout');
            const overlay = document.getElementById('sidebar-overlay');
            
            // Lógica da Sidebar Principal
            function toggleSidebar() {
                if (window.innerWidth <= 768) {
                    sidebar.classList.toggle('visible');
                    overlay.classList.toggle('visible');
                } else {
                    sidebar.classList.toggle('collapsed');
                    mainLayout.classList.toggle('collapsed');
                }
            }
            toggleButton.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', toggleSidebar);

            // Lógica do Flyout e Modal
            const flyoutOverlay = document.getElementById('flyoutCandidaturas');
            const modalOverlay = document.getElementById('modalPerfil');

            // Função para gerar as estrelas
            function generateStars(rating) {
                let starsHTML = '';
                let fullStars = Math.floor(rating);
                let halfStar = (rating % 1) >= 0.5 ? 1 : 0;
                let emptyStars = 5 - fullStars - halfStar;

                for(let i = 0; i < fullStars; i++) {
                    starsHTML += '<span class="material-icons-outlined">star</span>';
                }
                if(halfStar) {
                    starsHTML += '<span class="material-icons-outlined">star_half</span>';
                }
                for(let i = 0; i < emptyStars; i++) {
                    starsHTML += '<span class="material-icons-outlined empty">star_border</span>';
                }
                return starsHTML;
            }

            // Mock de dados de avaliações (simulação)
            const mockReviews = {
                'ativo': [
                    { from: 'Home Care ABC', quote: 'Profissional exemplar, sempre pontual.' },
                    { from: 'Clínica XYZ', quote: 'Ótimo com pacientes de mobilidade reduzida.' }
                ],
                'inativo': [
                    { from: 'Hospital Central', quote: 'Atrasou em 2 dos 3 plantões.' },
                    { from: 'Home Care ABC', quote: 'Paciente reportou falta de atenção.' }
                ]
            };


            // Funções globais para serem chamadas pelo HTML
            window.openFlyout = function(vagaId) {
                flyoutOverlay.classList.add('visible');
            }
            window.closeFlyout = function() {
                flyoutOverlay.classList.remove('visible');
            }
            
            window.openModal = function(candidatoNome, iniciais, cor, rating, corenStatus) {
                closeFlyout(); // Fecha o flyout para focar no modal
                
                const photoEl = document.getElementById('modal-photo');
                const nameEl = document.getElementById('modal-name');
                const corenTagEl = document.getElementById('modal-coren-tag');
                const corenIdEl = document.getElementById('modal-coren-id');
                const ratingEl = document.getElementById('modal-rating');
                const reviewsListEl = document.getElementById('modal-reviews-list');
                
                // Preenche dados básicos
                nameEl.textContent = candidatoNome;
                photoEl.textContent = iniciais;
                photoEl.style.backgroundColor = cor;

                // Preenche Tag do COREN (ATIVO vs INATIVO)
                if (corenStatus === 'ativo') {
                    corenTagEl.innerHTML = '<span class="material-icons-outlined">shield</span> ATIVO';
                    corenTagEl.className = 'profile-coren-tag active';
                    corenIdEl.textContent = 'Coren SP-123456 (Ativo)';
                } else {
                    corenTagEl.innerHTML = '<span class="material-icons-outlined">cancel</span> INATIVO';
                    corenTagEl.className = 'profile-coren-tag inactive';
                    corenIdEl.textContent = 'Coren SP-789012 (Inativo/Vencido)';
                }

                // Preenche Estrelas
                ratingEl.innerHTML = generateStars(rating);
                
                // Preenche Avaliações
                reviewsListEl.innerHTML = ''; // Limpa avaliações antigas
                const reviews = mockReviews[corenStatus] || [];
                reviews.forEach(review => {
                    reviewsListEl.innerHTML += `
                        <div class="review-item">
                            <blockquote>"${review.quote}"</blockquote>
                            <span>- ${review.from}</span>
                        </div>
                    `;
                });

                modalOverlay.style.display = 'flex';
            }
            
            window.closeModal = function() {
                modalOverlay.style.display = 'none';
            }

            // Fechar ao clicar fora
            flyoutOverlay.addEventListener('click', (e) => {
                if (e.target === flyoutOverlay) {
                    closeFlyout();
                }
            });
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    closeModal();
                }
            });
        });
    </script>

</body>
</html>
